<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tweet Sentiment Analysis</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        margin: 0;
        padding: 0;
      }
      header {
        background: #1da1f2;
        color: #fff;
        padding: 15px;
        text-align: center;
      }
      #tweetContainer {
        max-height: 500px;
        overflow-y: auto;
        background: #fff;
        margin: 20px auto;
        padding: 10px;
        width: 80%;
        border: 1px solid #ddd;
      }
      .tweet-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #eee;
      }
      .tweet-text {
        flex: 3;
        padding-right: 10px;
      }
      .prediction {
        flex: 1;
        text-align: center;
        font-weight: bold;
        color: #333;
      }
      .controls {
        text-align: center;
        margin: 20px;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        background: #1da1f2;
        color: white;
        border: none;
        cursor: pointer;
      }
      button:hover {
        background: #0d8ddf;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Tweet Sentiment Analysis</h1>
    </header>

    <!-- Tweet listesi scroll bar ile kaydırılabilir -->
    <div id="tweetContainer">
      <!-- API'den gelen tweetler buraya eklenecek -->
    </div>

    <div class="controls">
      <button onclick="startExtraction()">Tweet Çekmeyi Başlat</button>
      <button onclick="stopExtraction()">Tweet Çekmeyi Durdur</button>
      <button onclick="startPrediction()">Prediction Başlat</button>
    </div>

    <script>
      let extractionActive = false;

      // Extraction başlatma isteği
      function startExtraction() {
        fetch("/start_extraction", { method: "POST" })
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            extractionActive = true;
            refreshTweets();
          });
      }

      // Extraction durdurma isteği
      function stopExtraction() {
        fetch("/stop_extraction", { method: "POST" })
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            extractionActive = false;
            refreshTweets();
          });
      }

      // Prediction başlatma isteği
      function startPrediction() {
        stopExtraction();
        setTimeout(function() {
          fetch("/start_prediction", { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              console.log(data);
              refreshTweets();
            });
        }, 1000);
      }

      // API'den tweetleri ve prediction sonuçlarını çekip listeye ekleyen fonksiyon
      function refreshTweets() {
        fetch("/get_tweets")
          .then((response) => response.json())
          .then((data) => {
            const container = document.getElementById("tweetContainer");
            container.innerHTML = "";
            data.forEach((item) => {
              const div = document.createElement("div");
              div.className = "tweet-item";
              div.innerHTML =
                `<div class="tweet-text">${item.tweet}</div>
                 <div class="prediction">${item.prediction}</div>`;
              container.appendChild(div);
            });

            
            // Yeni tweet eklendikçe otomatik olarak en alta kaydır
            if (extractionActive) {
              container.scrollTop = container.scrollHeight;
            }
          });
      }

      // Sayfa yüklendiğinde her 1 saniyede bir tweet listesini güncelle (polling)
      setInterval(refreshTweets, 1000);
    </script>
  </body>
</html>
